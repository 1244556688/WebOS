<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nebula OS - Explorer Pro</title>
    <style>
        :root {
            --bg-main: #001220;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-thick: rgba(20, 20, 25, 0.85);
            --border: 1px solid rgba(255, 255, 255, 0.15);
            --accent: #00a2ff;
            --text: #ffffff;
            --text-dim: #b0b0b0;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', system-ui; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg-main); color: var(--text); }

        /* å‹•æ…‹èƒŒæ™¯ */
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e); background-size: 400% 400%; animation: grad 15s infinite; }
        @keyframes grad { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

        /* --- é–å®šèˆ‡ç™»å…¥ä»‹é¢ --- */
        .full-screen-overlay { position: fixed; inset: 0; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(20px); transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .hidden { transform: translateY(-100%); opacity: 0; pointer-events: none; }
        .clock { font-size: 80px; font-weight: 200; margin-bottom: 10px; }

        /* --- è¦–çª—é€šç”¨æ¨£å¼ --- */
        .window {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            width: 80%; height: 75%; background: var(--glass-thick); backdrop-filter: blur(30px);
            border: var(--border); border-radius: 12px; display: none; flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 100; transition: 0.3s cubic-bezier(0.19, 1, 0.22, 1);
        }
        .window.active { display: flex; transform: translate(-50%, -50%) scale(1); }
        .win-header { height: 45px; display: flex; align-items: center; padding: 0 15px; border-bottom: var(--border); cursor: move; }
        .win-ctrl { display: flex; gap: 8px; margin-left: auto; }
        .ctrl-dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }

        /* --- æª”æ¡ˆç¸½ç®¡å°ˆå±¬ --- */
        .explorer-main { flex: 1; display: flex; overflow: hidden; }
        .sidebar { width: 200px; border-right: var(--border); padding: 15px; background: rgba(0,0,0,0.2); }
        .side-item { padding: 8px 12px; border-radius: 6px; cursor: pointer; margin-bottom: 5px; font-size: 14px; }
        .side-item:hover { background: var(--glass); }
        .side-item.active { background: var(--glass); border-left: 3px solid var(--accent); }

        .file-view { flex: 1; padding: 0; overflow-y: auto; display: flex; flex-direction: column; }
        .file-table-header { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 10px 20px; border-bottom: var(--border); font-size: 12px; color: var(--text-dim); }
        .file-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 12px 20px; font-size: 14px; border-bottom: rgba(255,255,255,0.05) 1px solid; cursor: pointer; transition: 0.2s; }
        .file-row:hover { background: var(--glass); }
        .file-info { display: flex; align-items: center; gap: 10px; }
        .file-icon { font-size: 20px; }

        /* --- å·¥ä½œåˆ— --- */
        .taskbar { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: auto; padding: 5px 15px; height: 55px; background: var(--glass); backdrop-filter: blur(15px); border: var(--border); border-radius: 15px; display: flex; align-items: center; gap: 15px; z-index: 900; }
        .task-icon { width: 40px; height: 40px; border-radius: 8px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .task-icon:hover { background: var(--glass); transform: translateY(-3px); }

        /* é€šç”¨æŒ‰éˆ• */
        .btn { background: var(--accent); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500; }
        .btn:hover { filter: brightness(1.2); }
        
        #toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 10px 20px; border-radius: 20px; font-size: 13px; opacity: 0; transition: 0.3s; z-index: 3000; }
    </style>
</head>
<body>

    <div id="bg-canvas"></div>

    <div id="lock-screen" class="full-screen-overlay" onclick="ui.unlock()">
        <div class="clock" id="lock-time">00:00</div>
        <div id="lock-date">2æœˆ15æ—¥ æ˜ŸæœŸæ—¥</div>
        <p style="margin-top: 50px; opacity: 0.6;">é»æ“Šä»¥é€²å…¥ç³»çµ±</p>
    </div>

    <div id="win-explorer" class="window">
        <div class="win-header">
            <span style="font-size: 13px;">ğŸ“ æª”æ¡ˆç¸½ç®¡</span>
            <div class="win-ctrl">
                <button class="btn" style="padding: 4px 10px; background: transparent;" onclick="fs.triggerUpload()">+ ä¸Šå‚³</button>
                <div class="ctrl-dot" style="background: #ff5f56;" onclick="ui.close('explorer')"></div>
            </div>
        </div>
        <div class="explorer-main">
            <div class="sidebar">
                <div class="side-item active">ğŸ  é¦–é </div>
                <div class="side-item">ğŸ“„ æ–‡ä»¶</div>
                <div class="side-item">ğŸ“¥ ä¸‹è¼‰</div>
                <div class="side-item">ğŸ–¼ï¸ åœ–ç‰‡</div>
            </div>
            <div class="file-view">
                <div class="file-table-header">
                    <span>åç¨±</span>
                    <span>ä¿®æ”¹æ—¥æœŸ</span>
                    <span>é¡å‹</span>
                    <span>å¤§å°</span>
                </div>
                <div id="file-list">
                    </div>
            </div>
        </div>
    </div>

    <input type="file" id="file-input" style="display:none" onchange="fs.handleUpload(this)">

    <div class="taskbar">
        <div class="task-icon" onclick="ui.toggle('explorer')">ğŸ“</div>
        <div class="task-icon">ğŸŒ</div>
        <div class="task-icon">âš™ï¸</div>
    </div>

    <div id="toast"></div>

    <script>
        // --- æ ¸å¿ƒç³»çµ±ç®¡ç† ---
        const ui = {
            unlock() { document.getElementById('lock-screen').classList.add('hidden'); },
            toggle(id) { 
                const win = document.getElementById('win-' + id);
                win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
                if(win.style.display === 'flex') {
                    win.classList.add('active');
                    if(id === 'explorer') fs.render();
                }
            },
            close(id) { document.getElementById('win-' + id).style.display = 'none'; },
            showToast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg; t.style.opacity = 1;
                setTimeout(() => t.style.opacity = 0, 2000);
            }
        };

        // --- æª”æ¡ˆç³»çµ±ç®¡ç† (Win11 é‚è¼¯) ---
        const fs = {
            dbName: 'nebula_vfs',
            
            // å–å¾—æ‰€æœ‰æª”æ¡ˆ
            getAll() {
                return JSON.parse(localStorage.getItem(this.dbName) || '[]');
            },

            // è§¸ç™¼ä¸Šå‚³
            triggerUpload() { document.getElementById('file-input').click(); },

            // è™•ç†ä¸Šå‚³ä¸¦è¨ˆç®—å…ƒæ•¸æ“š
            handleUpload(input) {
                const file = input.files[0];
                if(!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const files = this.getAll();
                    const newFile = {
                        id: Date.now(),
                        name: file.name,
                        type: file.name.split('.').pop().toUpperCase(),
                        size: file.size, // åŸå§‹å®¹é‡(Bytes)
                        lastModified: new Date().toLocaleString(),
                        content: e.target.result
                    };
                    
                    files.push(newFile);
                    localStorage.setItem(this.dbName, JSON.stringify(files));
                    ui.showToast(`ä¸Šå‚³æˆåŠŸ: ${file.name}`);
                    this.render();
                };
                reader.readAsText(file); // é€™è£¡é è¨­è®€å–æ–‡æœ¬ï¼Œåœ–ç‰‡å¯æ”¹ readAsDataURL
                input.value = '';
            },

            // æ ¼å¼åŒ–å®¹é‡
            formatSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },

            // å–å¾—åœ–ç¤º
            getIcon(type) {
                const icons = { 'HTML': 'ğŸŒ', 'CSS': 'ğŸ¨', 'JS': 'ğŸ“œ', 'TXT': 'ğŸ“„', 'PNG': 'ğŸ–¼ï¸', 'JPG': 'ğŸ–¼ï¸' };
                return icons[type] || 'ğŸ“„';
            },

            // æ¸²æŸ“æª”æ¡ˆæ¸…å–® (æ¨¡æ“¬ Windows 11 è¡¨æ ¼è¦–åœ–)
            render() {
                const list = document.getElementById('file-list');
                const files = this.getAll();
                list.innerHTML = '';

                if(files.length === 0) {
                    list.innerHTML = `<div style="text-align:center; padding:50px; color:gray;">è³‡æ–™å¤¾æ˜¯ç©ºçš„</div>`;
                    return;
                }

                files.forEach(f => {
                    const row = document.createElement('div');
                    row.className = 'file-row';
                    row.innerHTML = `
                        <div class="file-info">
                            <span class="file-icon">${this.getIcon(f.type)}</span>
                            <span>${f.name}</span>
                        </div>
                        <div style="color:var(--text-dim)">${f.lastModified}</div>
                        <div style="color:var(--text-dim)">${f.type} æª”æ¡ˆ</div>
                        <div style="color:var(--text-dim)">${this.formatSize(f.size)}</div>
                    `;
                    row.onclick = () => ui.showToast(`é–‹å•Ÿæª”æ¡ˆ: ${f.name} (å®¹é‡: ${this.formatSize(f.size)})`);
                    list.appendChild(row);
                });
            }
        };

        // æ›´æ–°æ™‚é–“
        function updateClock() {
            const now = new Date();
            document.getElementById('lock-time').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        }
        setInterval(updateClock, 1000);
        updateClock();

    </script>
</body>
</html>
